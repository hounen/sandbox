!==== 6J-SYMBOL ===============================================================
  MODULE SIXJ_DEF
    IMPLICIT NONE
    INTERFACE SIXJ
      DOUBLE PRECISION FUNCTION SIXJ_I(J1,J2,J3,J4,J5,J6)
        INTEGER,INTENT(IN) :: J1,J2,J3,J4,J5,J6
      END FUNCTION SIXJ_I
      DOUBLE PRECISION FUNCTION SIXJ_D(J1,J2,J3,J4,J5,J6)
        DOUBLE PRECISION,INTENT(IN) :: J1,J2,J3,J4,J5,J6
      END FUNCTION SIXJ_D
    END INTERFACE SIXJ
  END MODULE SIXJ_DEF
!==============================================================================

!==== 6J-SYMBOL FOR INTEGER ARGUMENTS =========================================
  DOUBLE PRECISION FUNCTION SIXJ_I(J1,J2,J3,J4,J5,J6)
    USE FACTORIAL
    IMPLICIT NONE
    INTEGER,INTENT(IN) :: J1,J2,J3,J4,J5,J6
    INTEGER :: IJ1,IJ2,IJ3,IJ4,IJ5,IJ6
    INTEGER :: I,II1,II2,II3,II4
    INTEGER :: IA1,IA2,IA3,IA4,IB1,IB2,IB3,IB4
    INTEGER :: IC1,IC2,IC3,IC4,ID1,ID2,ID3,ID4
    INTEGER :: KK1,KK2,KK3,KK4,KK5,KK6,KK7,KK8,KMAX,KMIN
    DOUBLE PRECISION :: SQFLG,SLG
    SIXJ_I=0.D0
      
    CALL SET_FACT
    IF(MIN0(J1,J2,J3,J4,J5,J6).LT.0) RETURN
    IJ1=2*J1
    IJ2=2*J2
    IJ3=2*J3
    IJ4=2*J4
    IJ5=2*J5
    IJ6=2*J6

    II1=IJ1+IJ2+IJ3
    II2=IJ4+IJ5+IJ3
    II3=IJ1+IJ5+IJ6
    II4=IJ4+IJ2+IJ6
    IF(II1/2*2.NE.II1) RETURN
    IF(II2/2*2.NE.II2) RETURN
    IF(II3/2*2.NE.II3) RETURN
    IF(II4/2*2.NE.II4) RETURN

    IF(IABS(IJ1-IJ2).GT.IJ3.OR.IJ1+IJ2.LT.IJ3) RETURN
    IF(IABS(IJ4-IJ5).GT.IJ3.OR.IJ4+IJ5.LT.IJ3) RETURN
    IF(IABS(IJ1-IJ5).GT.IJ6.OR.IJ1+IJ5.LT.IJ6) RETURN
    IF(IABS(IJ4-IJ2).GT.IJ6.OR.IJ4+IJ2.LT.IJ6) RETURN
!
! MAIN PART
!
    IF(MIN0(IJ1,IJ2,IJ3,IJ4,IJ5,IJ6).EQ.0) THEN
      IF(IJ1.EQ.0) THEN
        SIXJ_I=(-1.D0)**((IJ2+IJ4+IJ5)/2)/DSQRT((IJ2+1.D0)*(IJ5+1.D0))
        RETURN
      ELSEIF(IJ2.EQ.0) THEN
        SIXJ_I=(-1.D0)**((IJ1+IJ4+IJ5)/2)/DSQRT((IJ1+1.D0)*(IJ4+1.D0))
        RETURN
      ELSEIF(IJ3.EQ.0) THEN
        SIXJ_I=(-1.D0)**((IJ1+IJ5+IJ6)/2)/DSQRT((IJ1+1.D0)*(IJ4+1.D0))
        RETURN
      ELSEIF(IJ4.EQ.0) THEN
        SIXJ_I=(-1.D0)**((IJ1+IJ2+IJ5)/2)/DSQRT((IJ2+1.D0)*(IJ3+1.D0))
        RETURN
      ELSEIF(IJ5.EQ.0) THEN
        SIXJ_I=(-1.D0)**((IJ1+IJ2+IJ4)/2)/DSQRT((IJ1+1.D0)*(IJ3+1.D0))
        RETURN
      ELSE
        SIXJ_I=(-1.D0)**((IJ1+IJ2+IJ3)/2)/DSQRT((IJ1+1.D0)*(IJ2+1.D0))
        RETURN
      ENDIF
    ENDIF

    IA4=(IJ1+IJ2+IJ3)/2
    IA1=IA4-IJ1
    IA2=IA4-IJ2
    IA3=IA4-IJ3
    IA4=IA4+1
    IB4=(IJ4+IJ5+IJ3)/2
    IB1=IB4-IJ4
    IB2=IB4-IJ5
    IB3=IB4-IJ3
    IB4=IB4+1
    IC4=(IJ1+IJ5+IJ6)/2
    IC1=IC4-IJ1
    IC2=IC4-IJ5
    IC3=IC4-IJ6
    IC4=IC4+1
    ID4=(IJ4+IJ2+IJ6)/2
    ID1=ID4-IJ4
    ID2=ID4-IJ2
    ID3=ID4-IJ6
    ID4=ID4+1
    SQFLG=0.5D0*(FACLOG(IA1)+FACLOG(IA2)+FACLOG(IA3)-FACLOG(IA4)              &
    &           +FACLOG(IB1)+FACLOG(IB2)+FACLOG(IB3)-FACLOG(IB4)              &
    &           +FACLOG(IC1)+FACLOG(IC2)+FACLOG(IC3)-FACLOG(IC4)              &
    &           +FACLOG(ID1)+FACLOG(ID2)+FACLOG(ID3)-FACLOG(ID4))

    KK2=(IJ1+IJ2+IJ3)/2
    KK3=(IJ1+IJ5+IJ6)/2
    KK4=(IJ4+IJ2+IJ6)/2
    KK5=(IJ4+IJ5+IJ3)/2
    KK6=(IJ1+IJ2+IJ4+IJ5)/2
    KK7=(IJ2+IJ3+IJ5+IJ6)/2
    KK8=(IJ1+IJ3+IJ4+IJ6)/2
    KMIN=MAX0(KK2,KK3,KK4,KK5)
    KMAX=MIN0(KK6,KK7,KK8)
    IF(KMIN.GT.KMAX) RETURN
    DO KK1=KMIN,KMAX
      SLG=SQFLG+FACLOG(KK1+1)-FACLOG(KK1-KK2)-FACLOG(KK1-KK3)-FACLOG(KK1-KK4) &
    &    -FACLOG(KK1-KK5)-FACLOG(KK6-KK1)-FACLOG(KK7-KK1)-FACLOG(KK8-KK1)
      SIXJ_I=SIXJ_I+(-1.D0)**KK1*DEXP(SLG)
    ENDDO
    RETURN
  END FUNCTION SIXJ_I
!==============================================================================

!==== 6J-SYMBOL FOR DOUBLE PRECISION ARGUMENTS ================================
  DOUBLE PRECISION FUNCTION SIXJ_D(J1,J2,J3,J4,J5,J6)
    USE FACTORIAL
    IMPLICIT NONE
    DOUBLE PRECISION,INTENT(IN) :: J1,J2,J3,J4,J5,J6
    INTEGER :: IJ1,IJ2,IJ3,IJ4,IJ5,IJ6
    INTEGER :: I,II1,II2,II3,II4
    INTEGER :: IA1,IA2,IA3,IA4,IB1,IB2,IB3,IB4
    INTEGER :: IC1,IC2,IC3,IC4,ID1,ID2,ID3,ID4
    INTEGER :: KK1,KK2,KK3,KK4,KK5,KK6,KK7,KK8,KMAX,KMIN
    DOUBLE PRECISION :: SQFLG,SLG
    SIXJ_D=0.D0
      
    CALL SET_FACT
    IF(DMIN1(J1,J2,J3,J4,J5,J6).LT.0.D0) RETURN
    IJ1=IDINT(2.D0*J1+0.01D0)
    IJ2=IDINT(2.D0*J2+0.01D0)
    IJ3=IDINT(2.D0*J3+0.01D0)
    IJ4=IDINT(2.D0*J4+0.01D0)
    IJ5=IDINT(2.D0*J5+0.01D0)
    IJ6=IDINT(2.D0*J6+0.01D0)

    II1=IJ1+IJ2+IJ3
    II2=IJ4+IJ5+IJ3
    II3=IJ1+IJ5+IJ6
    II4=IJ4+IJ2+IJ6
    IF(II1/2*2.NE.II1) RETURN
    IF(II2/2*2.NE.II2) RETURN
    IF(II3/2*2.NE.II3) RETURN
    IF(II4/2*2.NE.II4) RETURN

    IF(IABS(IJ1-IJ2).GT.IJ3.OR.IJ1+IJ2.LT.IJ3) RETURN
    IF(IABS(IJ4-IJ5).GT.IJ3.OR.IJ4+IJ5.LT.IJ3) RETURN
    IF(IABS(IJ1-IJ5).GT.IJ6.OR.IJ1+IJ5.LT.IJ6) RETURN
    IF(IABS(IJ4-IJ2).GT.IJ6.OR.IJ4+IJ2.LT.IJ6) RETURN
!
! MAIN PART
!
    IF(MIN0(IJ1,IJ2,IJ3,IJ4,IJ5,IJ6).EQ.0) THEN
      IF(IJ1.EQ.0) THEN
        SIXJ_D=(-1.D0)**((IJ2+IJ4+IJ5)/2)/DSQRT((IJ2+1.D0)*(IJ5+1.D0))
        RETURN
      ELSEIF(IJ2.EQ.0) THEN
        SIXJ_D=(-1.D0)**((IJ1+IJ4+IJ5)/2)/DSQRT((IJ1+1.D0)*(IJ4+1.D0))
        RETURN
      ELSEIF(IJ3.EQ.0) THEN
        SIXJ_D=(-1.D0)**((IJ1+IJ5+IJ6)/2)/DSQRT((IJ1+1.D0)*(IJ4+1.D0))
        RETURN
      ELSEIF(IJ4.EQ.0) THEN
        SIXJ_D=(-1.D0)**((IJ1+IJ2+IJ5)/2)/DSQRT((IJ2+1.D0)*(IJ3+1.D0))
        RETURN
      ELSEIF(IJ5.EQ.0) THEN
        SIXJ_D=(-1.D0)**((IJ1+IJ2+IJ4)/2)/DSQRT((IJ1+1.D0)*(IJ3+1.D0))
        RETURN
      ELSE
        SIXJ_D=(-1.D0)**((IJ1+IJ2+IJ3)/2)/DSQRT((IJ1+1.D0)*(IJ2+1.D0))
        RETURN
      ENDIF
    ENDIF

    IA4=(IJ1+IJ2+IJ3)/2
    IA1=IA4-IJ1
    IA2=IA4-IJ2
    IA3=IA4-IJ3
    IA4=IA4+1
    IB4=(IJ4+IJ5+IJ3)/2
    IB1=IB4-IJ4
    IB2=IB4-IJ5
    IB3=IB4-IJ3
    IB4=IB4+1
    IC4=(IJ1+IJ5+IJ6)/2
    IC1=IC4-IJ1
    IC2=IC4-IJ5
    IC3=IC4-IJ6
    IC4=IC4+1
    ID4=(IJ4+IJ2+IJ6)/2
    ID1=ID4-IJ4
    ID2=ID4-IJ2
    ID3=ID4-IJ6
    ID4=ID4+1
    SQFLG=0.5D0*(FACLOG(IA1)+FACLOG(IA2)+FACLOG(IA3)-FACLOG(IA4)              &
    &           +FACLOG(IB1)+FACLOG(IB2)+FACLOG(IB3)-FACLOG(IB4)              &
    &           +FACLOG(IC1)+FACLOG(IC2)+FACLOG(IC3)-FACLOG(IC4)              &
    &           +FACLOG(ID1)+FACLOG(ID2)+FACLOG(ID3)-FACLOG(ID4))

    KK2=(IJ1+IJ2+IJ3)/2
    KK3=(IJ1+IJ5+IJ6)/2
    KK4=(IJ4+IJ2+IJ6)/2
    KK5=(IJ4+IJ5+IJ3)/2
    KK6=(IJ1+IJ2+IJ4+IJ5)/2
    KK7=(IJ2+IJ3+IJ5+IJ6)/2
    KK8=(IJ1+IJ3+IJ4+IJ6)/2
    KMIN=MAX0(KK2,KK3,KK4,KK5)
    KMAX=MIN0(KK6,KK7,KK8)
    IF(KMIN.GT.KMAX) RETURN
    DO KK1=KMIN,KMAX
      SLG=SQFLG+FACLOG(KK1+1)-FACLOG(KK1-KK2)-FACLOG(KK1-KK3)-FACLOG(KK1-KK4) &
    &    -FACLOG(KK1-KK5)-FACLOG(KK6-KK1)-FACLOG(KK7-KK1)-FACLOG(KK8-KK1)
      SIXJ_D=SIXJ_D+(-1.D0)**KK1*DEXP(SLG)
    ENDDO
    RETURN
  END FUNCTION SIXJ_D
!==============================================================================

